<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>map</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link ref="stylesheet" type="text/css" href="css/map.css" />
    <script
      src="https://kit.fontawesome.com/83496dc54d.js"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d2481bf8dd089370ad295dd73d94a65a"
    ></script>
    <script src="../src/jquery.js"></script>
    <script src="../src/map.js"></script>
    <script src="../src/marker.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/navigator.css" />
    <script src="../src/navigator.js"></script>
    <script>
      var stat;
      var role;
      var ButtonJq;
      var PrefixJq;
      var korean = {
        from: "출발지",
        to: "도착지",
      };
      var orderStat = ["from", "to", "reserve"];
      var statnum = 0;

      try {
        stat = top.args["stat"];
        role = top.args["role"];
      } catch (e) {
        console.log(e);
        stat = "reserving";
        console.log("set stat as reserving.");
      }

      $(document).ready(function () {
        ButtonJq = $("#next");
        PrefixJq = $("#prefix");
        $("unuse#NextButton").on("click", function () {
          top.args["from"] = from;
          top.args["to"] = to;
          console.log("Move to call-reservation");
          window.location.href = "call-reservation.html";
        });
        $("#next").click(function () {
          var thisJq = $(this);
          if (thisJq.hasClass("on")) {
            ClickedMarkerDelete();
            NextButtonSwitch(false);
            NextStat();
            PrefixModify();
          } else {
            alert(korean[OrderStat[statnum]] + "를 선택해주십시오");
          }
          if (statnum == 2) {
            GotoCallReservation();
          }
        });

        StartMap();
        if (stat == "reserving") {
          RecordPositionGet();
        } else if (stat == "wating") {
          TraceAnother(top.args["reqData"]["id"], "DRIVER");
          TraceAnother(top.args["id"], "STUDENT");
          $("#map-start-or-dest").hide();
          $("#calling-car").removeAttr("hidden");
          var s = $("#calling-car")
            .html()
            .replace("driverAddress", top.args["reqData"]["mp"]);
          $("#calling-car").html(s);
        }
      });

      function NextButtonSwitch(isOn) {
        if (isOn) {
          ButtonJq.removeClass("off");
          ButtonJq.addClass("on");
        } else {
          ButtonJq.removeClass("on");
          ButtonJq.addClass("off");
        }
      }

      function PrefixModify() {
        PrefixJq.html(korean[orderStat[statnum]]);
      }

      function GotoCallReservation() {
        var query = { fromName: from.name, toName: to.name };
        var querystr = new URLSearchParams(query).toString();
        console.log("Move to call-reservation");
        window.location.href = "call-reservation.html?" + querystr;
      }
    </script>
  </head>

  <body>
    <div id="infowindow-templete" class="template">
      <div id="positionName"></div>
      <div id="button-latitude" class="template"></div>
      <div id="button-longitude" class="template"></div>
    </div>
    <div id="set-location" class="template"></div>
    <div id="map-explanation" class="front">
      <div id="calling-car" hidden>
        차량을 호출중입니다.(연락처는: driverAddress입니다.)
      </div>
      <div id="map-start-or-dest">
        <span id="prefix">출발지</span>를 선택하세요
      </div>
    </div>
    <div id="header">
      <input id="destination" type="text" placeholder=" 장소를 검색하세요" />
      <button id="search"><i class="fas fa-search"></i></button>
    </div>

    <div id="map"></div>
    <button id="next" class="off front">
      Next
      <img id="arrow" src="../korea-univ-logo/Image/left arrow.png" />
    </button>
  </body>
</html>
