<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>map</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        font-family: "Noto Sans KR", sans-serif;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
      }

      #map {
        width: 100%;
        height: 100%;
      }

      .template {
        display: none;
      }

      .off {
        background-color: darkgray;
      }
      .on {
        background-color: #8c0000;
      }
      .front {
        z-index: 2;
      }
      #map-explanation {
        padding-left: 10px;
        padding: 5px 10px 5px 18px;

        background-color: white;
        font-size: 24px;
        font-weight: bold;

        box-shadow: 0px 0px 10px 0px black;

        position: fixed;
        top: 0px;
        width: 100%;
      }

      #header {
        width: 80%;
        height: 46px;

        margin: 20px 0px;

        display: flex;
        align-items: center;
        justify-content: center;

        box-shadow: 0px 0px 10px 0px darkgray;
        border-radius: 50px;

        position: fixed;
        top: 60px;
        left: 50%;
        transform: translate(-50%, 0);
        z-index: 2;
      }

      #destination {
        margin-right: 0;
        font-size: 20px;

        border: none;
        width: 180px;
        z-index: 2;
      }

      #search {
        font-size: 18px;
        color: #8c0000;

        width: 30px;
        height: 30px;
        border-radius: 30px;
        background-color: white;
        border: none;

        display: inline-block;
        flex-shrink: 0;

        position: relative;
        left: 30px;
      }

      #next {
        position: absolute;
        bottom: 24px;
        left: 50%;
        transform: translate(-50%, 0%);

        border: none;

        width: 230px;
        height: 70px;
        padding: 10px 20px;

        color: white;
        font-size: 20px;
        text-align: left;
      }

      #arrow {
        width: 30px;
        position: absolute;
        right: 10px;
        filter: invert(100);
        z-index: inherit;
      }
    </style>
    <script
      src="https://kit.fontawesome.com/83496dc54d.js"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d2481bf8dd089370ad295dd73d94a65a"
    ></script>
    <script src="../src/jquery.js"></script>
    <script src="../src/map.js"></script>
    <script src="../src/marker.js"></script>
    <script>
      var stat;
      var role;
      var ButtonJq;
      var PrefixJq;
      var korean = {
        from: "출발지",
        to: "도착지",
      };
      var orderStat = ["from", "to", "reserve"];
      var statnum = 0;

      try {
        stat = top.args["stat"];
        role = top.args["role"];
      } catch (e) {
        console.log(e);
        stat = "reserving";
        console.log("set stat as reserving.");
      }

      $(document).ready(function () {
        ButtonJq = $("#next");
        PrefixJq = $("#prefix");
        $("unuse#NextButton").on("click", function () {
          top.args["from"] = from;
          top.args["to"] = to;
          console.log("Move to call-reservation");
          window.location.href = "call-reservation.html";
        });
        $("#next").click(function () {
          var thisJq = $(this);
          if (thisJq.hasClass("on")) {
            ClickedMarkerDelete();
            NextButtonSwitch(false);
            NextStat();
            PrefixModify();
          } else {
            alert(korean[OrderStat[statnum]] + "를 선택해주십시오");
          }
          if (statnum == 2) {
            GotoCallReservation();
          }
        });

        StartMap();
        if (stat == "reserving") {
          RecordPositionGet();
        } else if (stat == "wating") {
          TraceAnother(top.args["reqData"]["id"], "DRIVER");
          TraceAnother(top.args["id"], "STUDENT");
          $("#map-start-or-dest").hide();
          $("#calling-car").removeAttr("hidden");
          var s = $("#calling-car")
            .html()
            .replace("driverAddress", top.args["reqData"]["mp"]);
          $("#calling-car").html(s);
        }
      });

      function NextButtonSwitch(isOn) {
        if (isOn) {
          ButtonJq.removeClass("off");
          ButtonJq.addClass("on");
        } else {
          ButtonJq.removeClass("on");
          ButtonJq.addClass("off");
        }
      }

      function PrefixModify() {
        PrefixJq.html(korean[orderStat[statnum]]);
      }

      function GotoCallReservation() {
        var query = { fromName: from.name, toName: to.name };
        var querystr = new URLSearchParams(query).toString();
        console.log("Move to call-reservation");
        window.location.href = "call-reservation.html?" + querystr;
      }
    </script>
  </head>

  <body>
    <div id="infowindow-templete" class="template">
      <div id="positionName"></div>
      <div id="button-latitude" class="template"></div>
      <div id="button-longitude" class="template"></div>
    </div>
    <div id="set-location" class="template"></div>
    <div id="map-explanation" class="front">
      <div id="calling-car" hidden>
        차량을 호출중입니다.(연락처는: driverAddress입니다.)
      </div>
      <div id="map-start-or-dest">
        <div id="prefix">출발지</div>
        를 선택하세요
      </div>
    </div>
    <div id="header">
      <input id="destination" type="text" placeholder=" 장소를 검색하세요" />
      <button id="search"><i class="fas fa-search"></i></button>
    </div>

    <div id="map"></div>
    <button id="next" class="off front">
      Next
      <img id="arrow" src="../korea-univ-logo/Image/left arrow.png" />
    </button>
  </body>
</html>
