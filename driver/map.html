<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="../css/header.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/map.css" />
    <link rel="stylesheet" type="text/css" href="../css/navigator.css" />
    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d2481bf8dd089370ad295dd73d94a65a"
    ></script>
    <script src="../src/jquery.js"></script>
    <script src="../src/navigator.js"></script>
    <script src="../src/map.js"></script>
    <script>
      $(document).ready(function () {
        startMap();
        setInterval(checkReservation, 1000);
        traceAnother(top.args["id"], "DRIVER");
        if (top.debugging) {
          $("#map").height("80%");
          $("#debugging").show();
          $("#button").on("click", function () {
            moveToNew([
              {
                name: "asdf",
                time: "2021-10-03T11:32:40.000Z",
                now_name: "우당교양관",
                to_name: "정경대학과 타이거 프라자 사이",
              },
            ]);
            return false;
          });
        }
        if (top.args["stat"] == "working") {
          $("#ex1").hide();
          $("#ex2").removeAttr("hidden");
          traceAnother(top.args["reqData"]["id"], "STUDENT");
        }
      });

      function checkReservation() {
        $.ajax({
          url: window.location.origin + "/node/no-driver-request",
          type: "GET",
          error: function (jqxhr, textStatus, errorThrown) {
            console.log("Reservation Get Error");
          },
          success: function (data, textStatus, jqxhr) {
            if (data.length != 0) moveToNew(data);
            7;
          },
        });
      }

      function moveToNew(data) {
        top.args["reqData"] = data[0];
        console.log("Move to new-alarm");
        window.location.href = "new-alarm.html";
      }
    </script>
  </head>
  <body>
    <div id="header" class="front">
      <div id="ex2" hidden>운행을 시작합니다.</div>
      <div id="ex1">호출을 대기중입니다.</div>
    </div>
    <div id="map-container">
      <div id="map"></div>
    </div>
    <div id="debugging" hidden>
      <button id="button">호출 받기</button>
    </div>
  </body>
</html>
