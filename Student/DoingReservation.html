<!DOCTYPE html>
<!-- 2-2 -->
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>차량 호출중</title>    <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>FirstPage</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;700&display=swap"
            rel="stylesheet">
        <style>
            * {
                font-family: 'Noto Sans KR', sans-serif;
            }

            html,
            body {
                width: 100%;
                height: 100%;
                margin: 0;
            }
            #header {
                padding: 5px 10px 5px 18px;

                background-color: white;
                color: #8C0000;
                font-size: 20px;
                font-weight: bold;

                box-shadow: 0px 0px 10px 0px black;

                position: fixed;
                top: 0px;
                width: 100%;
            }
            .contents{
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);

                display: block;
                align-items: center;
                justify-content: center;
            }
            .contents>p{
                text-align: center;
                font-size: 18px;
            }
            /** BEGIN CSS **/
            @keyframes rotate-loading {
                0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
                100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
            }

            @-moz-keyframes rotate-loading {
                0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
                100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
            }

            @-webkit-keyframes rotate-loading {
                0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
                100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
            }

            @-o-keyframes rotate-loading {
                0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
                100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
            }

            @keyframes rotate-loading {
                0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
                100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
            }

            @-moz-keyframes rotate-loading {
                0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
                100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
            }

            @-webkit-keyframes rotate-loading {
                0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
                100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
            }

            @-o-keyframes rotate-loading {
                0%  {transform: rotate(0deg);-ms-transform: rotate(0deg); -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); -moz-transform: rotate(0deg);}
                100% {transform: rotate(360deg);-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); -moz-transform: rotate(360deg);}
            }

            @keyframes loading-text-opacity {
                0%  {opacity: 0}
                20% {opacity: 0}
                50% {opacity: 1}
                100%{opacity: 0}
            }

            @-moz-keyframes loading-text-opacity {
                0%  {opacity: 0}
                20% {opacity: 0}
                50% {opacity: 1}
                100%{opacity: 0}
            }

            @-webkit-keyframes loading-text-opacity {
                0%  {opacity: 0}
                20% {opacity: 0}
                50% {opacity: 1}
                100%{opacity: 0}
            }

            @-o-keyframes loading-text-opacity {
                0%  {opacity: 0}
                20% {opacity: 0}
                50% {opacity: 1}
                100%{opacity: 0}
            }
            .loading-container,
            .loading {
                height: 100px;
                position: relative;
                width: 100px;
                border-radius: 100%;
            }

            .loading-container { margin: 40px auto }

            .loading {
                border: 2px solid transparent;
                border-color: transparent #8C0000 transparent #8C0000;
                -moz-animation: rotate-loading 1.5s linear 0s infinite normal;
                -moz-transform-origin: 50% 50%;
                -o-animation: rotate-loading 1.5s linear 0s infinite normal;
                -o-transform-origin: 50% 50%;
                -webkit-animation: rotate-loading 1.5s linear 0s infinite normal;
                -webkit-transform-origin: 50% 50%;
                animation: rotate-loading 1.5s linear 0s infinite normal;
                transform-origin: 50% 50%;
            }

            .loading-container:hover .loading,
            .loading-container .loading {
                -webkit-transition: all 0.5s ease-in-out;
                -moz-transition: all 0.5s ease-in-out;
                -ms-transition: all 0.5s ease-in-out;
                -o-transition: all 0.5s ease-in-out;
                transition: all 0.5s ease-in-out;
            }

            #loading-text {
                -moz-animation: loading-text-opacity 3s linear 0s infinite normal;
                -o-animation: loading-text-opacity 3s linear 0s infinite normal;
                -webkit-animation: loading-text-opacity 3s linear 0s infinite normal;
                animation: loading-text-opacity 3s linear 0s infinite normal;
                color: #8C0000;
                font-size: 16px;
                font-weight: bold;
                margin-top: 45px;
                opacity: 0;
                position: absolute;
                text-align: center;
                text-transform: uppercase;
                top: 0;
                width: 100px;
            }
            /*RMx*/
            .buttons{
                width:100%;
                display:flex;
                justify-content: center;
            }
            .buttons>button{
                width: 146px;
                height: 48px;
                box-shadow: 0px 2px 7px darkgray;
                margin: 5px;
                font-size: 16px;
                border-radius: 1px;
            }
            .cancel{
                background-color: #8C0000;
                color: white;
                border: none;
            }
            .goback{
                background-color: white;
                color: #8C0000;
                border: 1px solid #8C0000;
            }
        </style>
        <script src="../src/JQuery.js"></script>
        <script src="../src/getQuery.js"></script>
        <script>
            var parse;

            window.onbeforeunload = CancelReservation;

            $(document).ready(function(){
                PrintData(top.args["from"]["name"],top.args["to"]["name"]);
                if(!top.debugging){
                    setInterval(() => ChackReservation(), 1000);
                } else {
                    setInterval(()=> SuccessReservation(), 1000);
                }
                $("#CancelReservation").click(CancelReservation);
            });

            function PrintData(fromName, toName){
                var dep =  $("#Departure > h4");
                var arr = $("#Arrival > h4");
                dep.html( dep.html() + fromName);
                arr.html( arr.html() + toName);
            }

            function ChackReservation(){
                if(!top.debugging){
                    var args = top.args;
                    $.ajax({
                        url:  window.location.origin + "/node/check-driver",
                        type: "GET",
                        data: {
                            "no" : args["requestid"],
                        },
                        error: function(jqXHR, textStatus, errorThrown){
                            alert("failed on chack reservation");
                        },
                        success: function(data, status, xhr){
                            if(data) data = data[0];
                            if(data == undefined) return;
                            if(data["name"] != null){
                                top.args['reqData']={};
                                top.args['reqData'] = data;
                                SuccessReservation();
                            }
                        }
                    });

                } else {

                }
            }

            function SuccessReservation(){
                top.args["stat"] ="wating";
                // To be add argument
                window.onbeforeunload = ()=>{};
                console.log("Move to Map.html");
                window.location.href = "Map.html"
            }
            function CancelReservation(){
                $.ajax({
                    url:  window.location.origin + "/node/reservation-delete",
                    type:"POST",
                    data:{
                        "no": top.args["requestid"],
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                        console.log("Error");
                        return false;
                    },
                    success: function(data, textStatus, jqXHR){
                        console.log("Move to CallReservation");
                        window.location.href = "CallReservation.html";
                    },
                });
            }

        </script>
    </head>
    <body>
        <div id="header"> 예약정보 확인하기 </div>
        <div class="contents">
            <p>호출 신청이 완료되었습니다.</p>
            <div class="loading-container">
                <div class="loading"></div>
                <div id="loading-text">loading</div>
            </div>
            <p>예약이 완료되면 <br> 알림 메시지를 보내드립니다.</p>
        <div class='buttons'>
            <button id="CancelReservation" class='cancel' type="Cancel"> 호출 취소 </button>
            <button id="CancelReservation" class="goback" type="Cancel"> 뒤로 가기 </button>
        </div>
        </div>
    </body>
</html>